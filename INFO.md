# Тестовое задание
Задачи для позиции Data Engineer в DS-команде WB

# Цели тестирования

- оценить качество написанного кода
- оценить навыки построения архитектуры сервиса

# Как оценивается результат
В процессе оценки будем смотреть на

- корректность решения
- логику архитектуры решения
- консистентный стиль написания кода, используемые стандарты форматирования кода, комментарии в коде
- использование системы контроля версий
- работу с виртуальным окружением (virtualenv, Pipenv, Poetry)
- наличие тестов, проверяющих работу различных частей системы

# Задание: сбор данных с инвестиционного форума

Требуется создать сервис, который, во-первых, собирает базу с данными, взятыми с сайта http://forum.mfd.ru/forum/subforum/?id=649, и во-вторых, предоставляет API, по которому можно запрашивать эти данные:

1. Создайте решение, которое собирает данные с раздела "Срочный рынок" форума MFD http://forum.mfd.ru/forum/subforum/?id=649 и структурированно сохраняет их в SQL-базу (например, SQLite)
2. Создайте сервер, который предоставляет API, позволяющее отфильтровывать или искать записи из БД, полученной в результате парсинга

Результатом выполнения задания будет git-репозиторий с кодом решения, а также полученная в результате база данных.

## Подробности

- Язык программирования: Python

- Требуется написать парсер сайта forum.mfd.ru. Он должен собирать все сообщения всех тем одного раздела форума - "Срочный рынок" http://forum.mfd.ru/forum/subforum/?id=649

- Для каждого поста форума должна быть собрана следующая информация:
1. id. Пример: `15127108`
2. URL, по которому доступен пост. Пример: `http://forum.mfd.ru/forum/post/?id=15127108`
3. id темы, в которой написан пост. Пример: `71831`
4. название темы, в которой написан пост. Пример: `Иллюзия торговли нефтью,золотом,звёздами***`
5. текст поста. Пример: `ждёмс`
6. id автора. Пример: `62347`
7. имя автора. Пример: `999 Девяточкин 999`
8. дата создания поста. Пример: `24.09.2018 20:02`
9. рейтинг поста. Пример: `-1`
10. в случае если это ответ на другой пост - id поста, на который отвечают. Пример: `15071068`

- Спарсенные данные нужно хранить в соответствующих им типах в структурированном виде: например, в одной или нескольких таблицах реляционной базы данных

- Требуется создать web-сервис с API, который отдает данные из полученной БД. То есть, должна быть возможность запустить сервер и слать ему запросы в формате JSON. Реализовать следующие эндпойнты (все эндпойнты работают с методом POST, на вход принимают body с данными в формате JSON, в ответе также возвращают JSON):
1. Эндпойнт `/search` для поиска постов по тексту: на вход в API приходит запрос с текстом и лимитом числа постов в формате `{"text": "золото", "count": 1000}`, на выходе отдаются все посты (по каждому посту отдаются все доступные в БД данные) с учетом лимита (параметр `count`), содержащие данный текст (параметр `text`). Сортировка результатов: от самомого нового к самому старому
2. Эндпойнт `/by_thread` для вывода постов темы: на вход подается id темы и лимит числа сообщений в формате `{"thread_id": 114198, "count": 1000}`, на выходе отдаются посты данной темы (по каждому посту отдаются все доступные в БД данные) с учетом лимита. Сортировка результатов: от самомого нового к самому старому
3. Эндпойнт `/replies` для поиска реплаев: на входе подается id поста (пример: `{"post_id": 20202744}`), на выходе отдается список id постов, которые отвечали на это сообщение. Сортировка результатов: по возрастанию id

- Можно использовать любые библиотеки. Все внешние библиотеки должны быть перечислены в зависимостях виртуального окружения (в `requirements.txt` или `Pipfile`, или `pyproject.toml`)

- Можно использовать библиотеки для парсинга - например, http://scrapy.org/.

# Дополнительные задания
- Автоматически генерируемая либо созданная вручную OpenAPI спецификация сервиса с документацией и примерами. Например, с помощью инструментов которые предоставляет библиотека FastAPI https://fastapi.tiangolo.com/tutorial/metadata/?h=#metadata-and-docs-urls
- Постраничный вывод сообщений: в эндпойнтах `search` и `/by_thread` на вход приходит дополнительный параметр `page` - номер желаемой страницы при постраничном выводе; параметр `count` считается числом сообщений на странице. Формат ответа не меняется, но при выводе нужно учитывать `page` и `count`
- Обработка невалидных запросов к API: когда клиент отправляет запрос к эндпойнту в некорректном формате (невалидный json, пустая строка для поиска, отсутствие каких-либо ключей в json, неверные типа данных в структуре запроса и т.д.), то сервер должен обработать подобный случай и вернуть код ошибки (например, 403) и описание ошибки в теле ответа
- Выделить удаленные по какой-либо причине сообщения (например, http://forum.mfd.ru/forum/post/?id=17624599#17624599): добавить в БД новое поле с фактом подобного удаления
- Dockerfile для запуска сервиса API и/или парсера в контейнере